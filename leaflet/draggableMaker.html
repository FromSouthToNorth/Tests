<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaflet Smooth Path Animation with Easing</title>
  <link rel="stylesheet" href="./src/css/leaflet.css" />
  <script src="./src/leaflet/leaflet.js"></script>
  <script src="./src/data/line.js"></script>
  <script src="./src/turf.js"></script>
  <style>
    #map {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
    }

    .point {
      border: 1px solid #f0f0f0;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #52c41a;
    }

    .start-point {
      border: 1px solid #f0f0f0;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #cf1322;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script>
    /** 
     *         y
     *      -2
     *      -1
     *-2 -1  0  1  2
     *       1       x
     *       2
     */
    let latlng = [30.63274, 104.07667]
    const map = L.map('map').setView(latlng, 12);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
    const icon = L.divIcon({ className: 'point' })
    const startMaker = L.marker([30.63274, 104.07667], { draggable: true, icon: L.divIcon({ className: 'start-point', iconSize: [16, 16] }) }).bindTooltip('拖动此标记,其他标记跟随移动', { permanent: true }).addTo(map)
    const fg = L.featureGroup().addTo(map)
    const c = []
    function addRandomMarkers(numMarkers) {
      for (let i = 0; i < numMarkers; i++) {
        // 随机生成纬度和经度
        let lat = latlng[0] + Math.random() * (-0.6 - 0.6) + 0.6; // 纬度范围
        let lng = latlng[1] + Math.random() * (-0.6 - 0.6) + 0.6;  // 经度范围
        // 创建标记并添加到地图
        fg.addLayer(L.marker([lat, lng], { icon, iconSize: [12, 12] }));
        var circle = turf.circle([lng, lat], 1.2, { steps: 99, units: 'kilometers' });
        fg.addLayer(L.GeoJSON.geometryToLayer(circle))
        c.push(turf.getCoords(circle))
      }
    }
    addRandomMarkers(3)

    const newC = [
      [
        [
          104.23556047608662,
          30.555707295419737
        ],
        [
          104.23478478282725,
          30.555858181711514
        ]
      ],
      [
        [
          104.23815442254192,
          30.535669081784626
        ],
        [
          104.2388492177414,
          30.536001999832038
        ]
      ],
      [
        [
          103.7588172795892,
          30.607242344926156
        ],
        [
          103.75802522404746,
          30.607307447074934
        ]
      ],
      [
        [
          104.22348315492522,
          30.537690869117768
        ],
        [
          104.2240586281953,
          30.537218336972447
        ]
      ],
      [
        [
          103.74495861693941,
          30.594326515171502
        ],
        [
          103.74514625861141,
          30.593661030406164
        ]
      ],
      [
        [
          104.23951810421262,
          30.536372199225426
        ],
        [
          104.24015838902858,
          30.536778189719698
        ]
      ],
      [
        [
          104.24486676998248,
          30.546456937723924
        ],
        [
          104.24475369303175,
          30.547134783937544
        ]
      ],
      [
        [
          103.76950131348516,
          30.594326515171502
        ],
        [
          103.76963954614803,
          30.59500090422868
        ]
      ],
      [
        [
          104.23743651574736,
          30.535374785236932
        ],
        [
          104.23815442254192,
          30.535669081784626
        ]
      ],
      [
        [
          103.55073449094124,
          30.58474876023827
        ],
        [
          103.55092211533017,
          30.585414245009808
        ]
      ],
      [
        [
          103.54862708211515,
          30.58108903637047
        ],
        [
          103.54908854505385,
          30.581646826732896
        ]
      ],
      [
        [
          104.22007242946844,
          30.547134783937544
        ],
        [
          104.21995935251775,
          30.546456937723924
        ]
      ],
      [
        [
          103.53090318574615,
          30.57914187005005
        ],
        [
          103.53154375018303,
          30.57873587961716
        ]
      ],
      [
        [
          104.22156170426638,
          30.53986500957166
        ],
        [
          104.2219809670722,
          30.539283146717796
        ]
      ],
      [
        [
          103.74701664878373,
          30.602796817673216
        ],
        [
          103.74657600029394,
          30.602226633817732
        ]
      ],
      [
        [
          103.53667137012033,
          30.576968760435562
        ],
        [
          103.53746038233153,
          30.57688207875139
        ]
      ],
      [
        [
          103.52971808982956,
          30.580054549320614
        ],
        [
          103.5302938144492,
          30.579582017239503
        ]
      ],
      [
        [
          103.53746038233153,
          30.57688207875139
        ],
        [
          103.53825419075287,
          30.576838650503262
        ]
      ],
      [
        [
          103.53825419075287,
          30.576838650503262
        ],
        [
          103.53904960005679,
          30.576838650503262
        ]
      ],
      [
        [
          103.76963954614803,
          30.59500090422868
        ],
        [
          103.76972781218387,
          30.595681482208423
        ]
      ],
      [
        [
          104.2270268619894,
          30.555005513382618
        ],
        [
          104.22632005279338,
          30.55469168619368
        ]
      ],
      [
        [
          103.55117399971101,
          30.588137959455306
        ],
        [
          103.55111104395952,
          30.588820617440366
        ]
      ],
      [
        [
          103.76151755652302,
          30.5863962458015
        ],
        [
          103.7622560750105,
          30.58665073612343
        ]
      ],
      [
        [
          103.7533174660934,
          30.606790293714194
        ],
        [
          103.75256980607207,
          30.606556051816998
        ]
      ],
      [
        [
          103.54509086205952,
          30.578365680282243
        ],
        [
          103.54576004062665,
          30.57873587961716
        ]
      ],
      [
        [
          103.74917039843181,
          30.604804116657796
        ],
        [
          103.74857747786454,
          30.604347471466642
        ]
      ],
      [
        [
          103.75408088536405,
          30.60698324642603
        ],
        [
          103.7533174660934,
          30.606790293714194
        ]
      ],
      [
        [
          104.23281059234206,
          30.534474969786682
        ],
        [
          104.23360405434114,
          30.53451839804293
        ]
      ],
      [
        [
          103.5497025850119,
          30.59272127135478
        ],
        [
          103.54930488038528,
          30.59331436360571
        ]
      ],
      [
        [
          104.24262097849655,
          30.551520867403745
        ],
        [
          104.24213945120412,
          30.552065846423766
        ]
      ],
      [
        [
          103.54640060506351,
          30.57914187005005
        ],
        [
          103.54700997636048,
          30.579582017239503
        ]
      ],
      [
        [
          103.54218338437863,
          30.57727031572136
        ],
        [
          103.54293909259711,
          30.57748397546037
        ]
      ],
      [
        [
          103.7695771230725,
          30.59841073383124
        ],
        [
          103.76941426597631,
          30.599081038738202
        ]
      ],
      [
        [
          103.76644052419927,
          30.603859376221056
        ],
        [
          103.76588245256002,
          30.604347471466642
        ]
      ],
      [
        [
          103.52760120579778,
          30.59272127135478
        ],
        [
          103.52724800540702,
          30.592107659267178
        ]
      ],
      [
        [
          104.22498280676369,
          30.553951521936053
        ],
        [
          104.22435775543126,
          30.553528166081126
        ]
      ],
      [
        [
          103.74775552887976,
          30.589469834276724
        ],
        [
          103.7482953382756,
          30.588966819578346
        ]
      ],
      [
        [
          103.52917833007591,
          30.580557564032475
        ],
        [
          103.52971808982956,
          30.580054549320614
        ]
      ],
      [
        [
          103.54256403459169,
          30.597878023368885
        ],
        [
          103.54180068554992,
          30.598070976073398
        ]
      ],
      [
        [
          104.22435775543126,
          30.553528166081126
        ],
        [
          104.22376514824819,
          30.55307152096733
        ]
      ],
      [
        [
          103.52656929986844,
          30.58474876023827
        ],
        [
          103.52680557227855,
          30.58409485921851
        ]
      ],
      [
        [
          103.76670440154481,
          30.589469834276724
        ],
        [
          103.76720606906493,
          30.590001306601476
        ]
      ],
      [
        [
          103.76766757445293,
          30.590559096951107
        ],
        [
          103.76808705904058,
          30.59114095973525
        ]
      ],
      [
        [
          104.24015838902858,
          30.536778189719698
        ],
        [
          104.24076749430492,
          30.537218336972447
        ]
      ],
      [
        [
          104.24397036901841,
          30.541091494862993
        ],
        [
          104.24425421309543,
          30.541731179406
        ]
      ],
      [
        [
          104.22597690475881,
          30.536001999832038
        ],
        [
          104.2266716999583,
          30.535669081784626
        ]
      ],
      [
        [
          103.7636695238166,
          30.587277950592046
        ],
        [
          103.76433876391255,
          30.58764814991465
        ]
      ],
      [
        [
          103.55021425036469,
          30.58345517471837
        ],
        [
          103.55049821853113,
          30.58409485921851
        ]
      ],
      [
        [
          104.23984331573652,
          30.553951521936053
        ],
        [
          104.23918833736685,
          30.554339883381342
        ]
      ],
      [
        [
          103.74482038427655,
          30.59500090422868
        ],
        [
          103.74495861693941,
          30.594326515171502
        ]
      ],
      [
        [
          104.23201553015815,
          30.534474969786682
        ],
        [
          104.23281059234206,
          30.534474969786682
        ]
      ],
      [
        [
          103.76975322115382,
          30.597050229608524
        ],
        [
          103.76969025964355,
          30.597732887595715
        ]
      ],
      [
        [
          103.74617825910764,
          30.601633541555092
        ],
        [
          103.7458250262534,
          30.60101992945671
        ]
      ],
      [
        [
          103.55083507561311,
          30.59016876857361
        ],
        [
          103.55062317224174,
          30.590828832879563
        ]
      ],
      [
        [
          103.53904960005679,
          30.576838650503262
        ],
        [
          103.53984340847812,
          30.57688207875139
        ]
      ],
      [
        [
          103.75722996521228,
          30.607329176967134
        ],
        [
          103.75643470637712,
          30.607307447074934
        ]
      ],
      [
        [
          103.75045110510679,
          30.605615834106345
        ],
        [
          103.74979578032718,
          30.605227472588346
        ]
      ],
      [
        [
          104.2219809670722,
          30.539283146717796
        ],
        [
          104.2224422284911,
          30.53872535629462
        ]
      ],
      [
        [
          103.53944708107832,
          30.598395176709715
        ],
        [
          103.53865189540484,
          30.598416906601045
        ]
      ],
      [
        [
          103.75564265083538,
          30.607242344926156
        ],
        [
          103.75485698896483,
          30.60713413275126
        ]
      ],
      [
        [
          104.2343927222205,
          30.534605079743255
        ],
        [
          104.23517342132395,
          30.534734665966184
        ]
      ],
      [
        [
          103.54576004062665,
          30.57873587961716
        ],
        [
          103.54640060506351,
          30.57914187005005
        ]
      ],
      [
        [
          103.55092211533017,
          30.585414245009808
        ],
        [
          103.55106033525192,
          30.58608863407161
        ]
      ],
      [
        [
          103.76828167131694,
          30.601633541555092
        ],
        [
          103.76788393013061,
          30.602226633817732
        ]
      ],
      [
        [
          103.74469417528998,
          30.596365508764904
        ],
        [
          103.74473211824069,
          30.595681482208423
        ]
      ],
      [
        [
          103.74476967078101,
          30.597732887595715
        ],
        [
          103.74470670927076,
          30.597050229608524
        ]
      ],
      [
        [
          103.53785670973134,
          30.598395176709715
        ],
        [
          103.53706472705623,
          30.598330074563503
        ]
      ],
      [
        [
          103.75842158781775,
          30.58579434911554
        ],
        [
          103.75921067256108,
          30.585881030796322
        ]
      ],
      [
        [
          104.24381197151264,
          30.549743979388328
        ],
        [
          104.24345892523587,
          30.550357591424785
        ]
      ],
      [
        [
          103.74749843065429,
          30.603341796768245
        ],
        [
          103.74701664878373,
          30.602796817673216
        ]
      ],
      [
        [
          104.23004133967298,
          30.555858181711514
        ],
        [
          104.2292656464136,
          30.555707295419737
        ]
      ],
      [
        [
          103.76969025964355,
          30.597732887595715
        ],
        [
          103.7695771230725,
          30.59841073383124
        ]
      ],
      [
        [
          104.24284515542801,
          30.539283146717796
        ],
        [
          104.24326441823384,
          30.53986500957166
        ]
      ],
      [
        [
          104.2208557534818,
          30.541091494862993
        ],
        [
          104.22118612876969,
          30.540468602311016
        ]
      ],
      [
        [
          103.54838253482914,
          30.5944295265307
        ],
        [
          103.54786160716144,
          30.594947105970128
        ]
      ],
      [
        [
          104.24490430321487,
          30.54440553234395
        ],
        [
          104.2449422259325,
          30.545089558907847
        ]
      ],
      [
        [
          104.24363999373054,
          30.540468602311016
        ],
        [
          104.24397036901841,
          30.541091494862993
        ]
      ],
      [
        [
          103.75762770642396,
          30.58575092086913
        ],
        [
          103.75842158781775,
          30.58579434911554
        ]
      ],
      [
        [
          103.74599709718697,
          30.591744552409804
        ],
        [
          103.746372871384,
          30.59114095973525
        ]
      ],
      [
        [
          103.53984340847812,
          30.57688207875139
        ],
        [
          103.54063242068935,
          30.576968760435562
        ]
      ],
      [
        [
          103.76788393013061,
          30.602226633817732
        ],
        [
          103.76744328164085,
          30.602796817673216
        ]
      ],
      [
        [
          104.2324130612501,
          30.55605322588344
        ],
        [
          104.23161822289725,
          30.556031495996184
        ]
      ],
      [
        [
          103.52615519766933,
          30.586769212054342
        ],
        [
          103.52624345555776,
          30.58608863407161
        ]
      ],
      [
        [
          104.22965270117626,
          30.534734665966184
        ],
        [
          104.23043340027971,
          30.534605079743255
        ]
      ],
      [
        [
          103.5284395184052,
          30.593884547448713
        ],
        [
          103.5279989104244,
          30.59331436360571
        ]
      ],
      [
        [
          103.76972781218387,
          30.595681482208423
        ],
        [
          103.7697657551346,
          30.596365508764904
        ]
      ],
      [
        [
          103.76497938725043,
          30.588054140334627
        ],
        [
          103.76558881458357,
          30.58849428751076
        ]
      ],
      [
        [
          104.24326441823384,
          30.53986500957166
        ],
        [
          104.24363999373054,
          30.540468602311016
        ]
      ],
      [
        [
          104.22033574027223,
          30.542385080462218
        ],
        [
          104.22057190940478,
          30.541731179406
        ]
      ],
      [
        [
          103.5286767086945,
          30.58108903637047
        ],
        [
          103.52917833007591,
          30.580557564032475
        ]
      ],
      [
        [
          103.75999178432188,
          30.586010616990336
        ],
        [
          103.76076177883016,
          30.586182586070517
        ]
      ],
      [
        [
          103.55049821853113,
          30.58409485921851
        ],
        [
          103.55073449094124,
          30.58474876023827
        ]
      ],
      [
        [
          103.75369815159442,
          30.586182586070517
        ],
        [
          103.7544681461027,
          30.586010616990336
        ]
      ],
      [
        [
          103.74725386135965,
          30.590001306601476
        ],
        [
          103.74775552887976,
          30.589469834276724
        ]
      ],
      [
        [
          103.75294237390155,
          30.5863962458015
        ],
        [
          103.75369815159442,
          30.586182586070517
        ]
      ],
      [
        [
          103.52779579975704,
          30.582228689529163
        ],
        [
          103.52821524575583,
          30.581646826732896
        ]
      ],
      [
        [
          103.5336262476149,
          30.577738465791644
        ],
        [
          103.53436469821254,
          30.57748397546037
        ]
      ],
      [
        [
          104.2292656464136,
          30.555707295419737
        ],
        [
          104.22850263076944,
          30.555514342749987
        ]
      ],
      [
        [
          103.75256980607207,
          30.606556051816998
        ],
        [
          103.75184091668176,
          30.60628146423962
        ]
      ],
      [
        [
          103.55062317224174,
          30.590828832879563
        ],
        [
          103.55036305999148,
          30.591475998507953
        ]
      ],
      [
        [
          104.21995935251775,
          30.546456937723924
        ],
        [
          104.21989642410479,
          30.54577427974901
        ]
      ],
      [
        [
          103.7622560750105,
          30.58665073612343
        ],
        [
          103.76297436131232,
          30.586945032610735
        ]
      ],
      [
        [
          103.75802522404746,
          30.607307447074934
        ],
        [
          103.75722996521228,
          30.607329176967134
        ]
      ],
      [
        [
          104.23478478282725,
          30.555858181711514
        ],
        [
          104.23399953635824,
          30.555966393862143
        ]
      ],
      [
        [
          104.23043340027971,
          30.534605079743255
        ],
        [
          104.23122206815907,
          30.53451839804293
        ]
      ],
      [
        [
          103.5302938144492,
          30.579582017239503
        ],
        [
          103.53090318574615,
          30.57914187005005
        ]
      ],
      [
        [
          103.74473211824069,
          30.595681482208423
        ],
        [
          103.74482038427655,
          30.59500090422868
        ]
      ],
      [
        [
          103.54786160716144,
          30.594947105970128
        ],
        [
          103.54730358684077,
          30.595435201202175
        ]
      ],
      [
        [
          103.55114859314035,
          30.586769212054342
        ],
        [
          103.55118653257064,
          30.58745323861212
        ]
      ],
      [
        [
          104.22775536603206,
          30.555280100902827
        ],
        [
          104.2270268619894,
          30.555005513382618
        ]
      ],
      [
        [
          103.54930488038528,
          30.59331436360571
        ],
        [
          103.54886427240446,
          30.593884547448713
        ]
      ],
      [
        [
          103.75524925786348,
          30.585881030796322
        ],
        [
          103.75603834260681,
          30.58579434911554
        ]
      ],
      [
        [
          104.22530801828759,
          30.536372199225426
        ],
        [
          104.22597690475881,
          30.536001999832038
        ]
      ],
      [
        [
          103.76616459214897,
          30.588966819578346
        ],
        [
          103.76670440154481,
          30.589469834276724
        ]
      ],
      [
        [
          104.22376514824819,
          30.55307152096733
        ],
        [
          104.22320737155228,
          30.552583425799558
        ]
      ],
      [
        [
          103.55106033525192,
          30.58608863407161
        ],
        [
          103.55114859314035,
          30.586769212054342
        ]
      ],
      [
        [
          103.76332619679671,
          30.605967636987277
        ],
        [
          103.7626190137428,
          30.60628146423962
        ]
      ],
      [
        [
          104.22850263076944,
          30.555514342749987
        ],
        [
          104.22775536603206,
          30.555280100902827
        ]
      ],
      [
        [
          103.75184091668176,
          30.60628146423962
        ],
        [
          103.75113373362787,
          30.605967636987277
        ]
      ],
      [
        [
          103.76558881458357,
          30.58849428751076
        ],
        [
          103.76616459214897,
          30.588966819578346
        ]
      ],
      [
        [
          103.54730358684077,
          30.595435201202175
        ],
        [
          103.54671072080068,
          30.59589184637987
        ]
      ],
      [
        [
          103.54367754319476,
          30.577738465791644
        ],
        [
          103.54439576346432,
          30.578032762289443
        ]
      ],
      [
        [
          103.52624345555776,
          30.58608863407161
        ],
        [
          103.5263816754795,
          30.585414245009808
        ]
      ],
      [
        [
          104.2388492177414,
          30.536001999832038
        ],
        [
          104.23951810421262,
          30.536372199225426
        ]
      ],
      [
        [
          103.76528953199275,
          30.604804116657796
        ],
        [
          103.7646641500974,
          30.605227472588346
        ]
      ],
      [
        [
          104.22001003849547,
          30.543724954347038
        ],
        [
          104.22014819793125,
          30.54305056526324
        ]
      ],
      [
        [
          103.53326334263207,
          30.597369193912943
        ],
        [
          103.53255622462746,
          30.597055366671636
        ]
      ],
      [
        [
          103.75683222400062,
          30.58575092086913
        ],
        [
          103.75762770642396,
          30.58575092086913
        ]
      ],
      [
        [
          103.54331162583571,
          30.597643781480386
        ],
        [
          103.54256403459169,
          30.597878023368885
        ]
      ],
      [
        [
          104.2240586281953,
          30.537218336972447
        ],
        [
          104.22466773347163,
          30.536778189719698
        ]
      ],
      [
        [
          103.54812546073374,
          30.580557564032475
        ],
        [
          103.54862708211515,
          30.58108903637047
        ]
      ],
      [
        [
          104.24449038222798,
          30.542385080462218
        ],
        [
          104.24467792456896,
          30.54305056526324
        ]
      ],
      [
        [
          104.23850606970684,
          30.55469168619368
        ],
        [
          104.23779926051081,
          30.555005513382618
        ]
      ],
      [
        [
          103.52708954044499,
          30.58345517471837
        ],
        [
          103.52742006013281,
          30.58283228221498
        ]
      ],
      [
        [
          104.24411911205266,
          30.549112318674908
        ],
        [
          104.24381197151264,
          30.549743979388328
        ]
      ],
      [
        [
          103.52724800540702,
          30.592107659267178
        ],
        [
          103.52694073081818,
          30.591475998507953
        ]
      ],
      [
        [
          103.54988373067687,
          30.58283228221498
        ],
        [
          103.55021425036469,
          30.58345517471837
        ]
      ],
      [
        [
          103.53000020396891,
          30.595435201202175
        ],
        [
          103.52944218364823,
          30.594947105970128
        ]
      ],
      [
        [
          103.7697657551346,
          30.596365508764904
        ],
        [
          103.76975322115382,
          30.597050229608524
        ]
      ],
      [
        [
          103.54758570098012,
          30.580054549320614
        ],
        [
          103.54812546073374,
          30.580557564032475
        ]
      ],
      [
        [
          103.54102465334634,
          30.598221862392812
        ],
        [
          103.54023906375343,
          30.598330074563503
        ]
      ],
      [
        [
          103.76588245256002,
          30.604347471466642
        ],
        [
          103.76528953199275,
          30.604804116657796
        ]
      ],
      [
        [
          104.22101415098759,
          30.549743979388328
        ],
        [
          104.22070701044755,
          30.549112318674908
        ]
      ],
      [
        [
          103.53436469821254,
          30.57748397546037
        ],
        [
          103.53512040643103,
          30.57727031572136
        ]
      ],
      [
        [
          103.76879338334268,
          30.59236744490297
        ],
        [
          103.76907737764806,
          30.59300712939408
        ]
      ],
      [
        [
          104.22044701164283,
          30.548465153086248
        ],
        [
          104.22023520065868,
          30.547805088813313
        ]
      ],
      [
        [
          103.76931367181317,
          30.593661030406164
        ],
        [
          103.76950131348516,
          30.594326515171502
        ]
      ],
      [
        [
          104.22320737155228,
          30.552583425799558
        ],
        [
          104.22268667129609,
          30.552065846423766
        ]
      ],
      [
        [
          103.52742006013281,
          30.58283228221498
        ],
        [
          103.52779579975704,
          30.582228689529163
        ]
      ],
      [
        [
          103.5279989104244,
          30.59331436360571
        ],
        [
          103.52760120579778,
          30.59272127135478
        ]
      ],
      [
        [
          103.74979578032718,
          30.605227472588346
        ],
        [
          103.74917039843181,
          30.604804116657796
        ]
      ],
      [
        [
          103.7646641500974,
          30.605227472588346
        ],
        [
          103.76400882531779,
          30.605615834106345
        ]
      ],
      [
        [
          104.24213945120412,
          30.552065846423766
        ],
        [
          104.24161875094794,
          30.552583425799558
        ]
      ],
      [
        [
          104.22466773347163,
          30.536778189719698
        ],
        [
          104.22530801828759,
          30.536372199225426
        ]
      ],
      [
        [
          104.22294363083813,
          30.538193883893705
        ],
        [
          104.22348315492522,
          30.537690869117768
        ]
      ],
      [
        [
          104.24046836706896,
          30.553528166081126
        ],
        [
          104.23984331573652,
          30.553951521936053
        ]
      ],
      [
        [
          104.24437911085738,
          30.548465153086248
        ],
        [
          104.24411911205266,
          30.549112318674908
        ]
      ],
      [
        [
          103.75921067256108,
          30.585881030796322
        ],
        [
          103.75999178432188,
          30.586010616990336
        ]
      ],
      [
        [
          103.76400882531779,
          30.605615834106345
        ],
        [
          103.76332619679671,
          30.605967636987277
        ]
      ],
      [
        [
          103.7684628332376,
          30.591744552409804
        ],
        [
          103.76879338334268,
          30.59236744490297
        ]
      ],
      [
        [
          104.23399953635824,
          30.555966393862143
        ],
        [
          104.23320789960296,
          30.556031495996184
        ]
      ],
      [
        [
          103.746372871384,
          30.59114095973525
        ],
        [
          103.74679235597165,
          30.590559096951107
        ]
      ],
      [
        [
          103.55099791776209,
          30.58949846367208
        ],
        [
          103.55083507561311,
          30.59016876857361
        ]
      ],
      [
        [
          103.53187365889428,
          30.596703563802627
        ],
        [
          103.53121839438816,
          30.596315202297273
        ]
      ],
      [
        [
          103.74504566444827,
          30.599081038738202
        ],
        [
          103.74488280735208,
          30.59841073383124
        ]
      ],
      [
        [
          103.74679235597165,
          30.590559096951107
        ],
        [
          103.74725386135965,
          30.590001306601476
        ]
      ],
      [
        [
          103.53154375018303,
          30.57873587961716
        ],
        [
          103.53221292875016,
          30.578365680282243
        ]
      ],
      [
        [
          103.55005578540265,
          30.592107659267178
        ],
        [
          103.5497025850119,
          30.59272127135478
        ]
      ],
      [
        [
          103.54293909259711,
          30.57748397546037
        ],
        [
          103.54367754319476,
          30.577738465791644
        ]
      ],
      [
        [
          104.23517342132395,
          30.534734665966184
        ],
        [
          104.23594300904061,
          30.534906635084194
        ]
      ],
      [
        [
          103.74857747786454,
          30.604347471466642
        ],
        [
          103.74801940622531,
          30.603859376221056
        ]
      ],
      [
        [
          103.7626190137428,
          30.60628146423962
        ],
        [
          103.76189012435248,
          30.606556051816998
        ]
      ],
      [
        [
          103.55111104395952,
          30.588820617440366
        ],
        [
          103.55099791776209,
          30.58949846367208
        ]
      ],
      [
        [
          103.76114246433116,
          30.606790293714194
        ],
        [
          103.76037904506053,
          30.60698324642603
        ]
      ],
      [
        [
          103.54474756618222,
          30.597055366671636
        ],
        [
          103.5440404481776,
          30.597369193912943
        ]
      ],
      [
        [
          103.54063242068935,
          30.576968760435562
        ],
        [
          103.54141346064995,
          30.577098346634603
        ]
      ],
      [
        [
          103.5454301319154,
          30.596703563802627
        ],
        [
          103.54474756618222,
          30.597055366671636
        ]
      ],
      [
        [
          103.54671072080068,
          30.59589184637987
        ],
        [
          103.54608539642152,
          30.596315202297273
        ]
      ],
      [
        [
          103.7544681461027,
          30.586010616990336
        ],
        [
          103.75524925786348,
          30.585881030796322
        ]
      ],
      [
        [
          103.74948054317413,
          30.588054140334627
        ],
        [
          103.75012116651203,
          30.58764814991465
        ]
      ],
      [
        [
          104.22268667129609,
          30.552065846423766
        ],
        [
          104.22220514400367,
          30.551520867403745
        ]
      ],
      [
        [
          103.7453825527765,
          30.59300712939408
        ],
        [
          103.7456665470819,
          30.59236744490297
        ]
      ],
      [
        [
          103.76433876391255,
          30.58764814991465
        ],
        [
          103.76497938725043,
          30.588054140334627
        ]
      ],
      [
        [
          103.52668061856792,
          30.590828832879563
        ],
        [
          103.52646871519657,
          30.59016876857361
        ]
      ],
      [
        [
          103.7458250262534,
          30.60101992945671
        ],
        [
          103.7455177234277,
          30.60038826868784
        ]
      ],
      [
        [
          103.74470670927076,
          30.597050229608524
        ],
        [
          103.74469417528998,
          30.596365508764904
        ]
      ],
      [
        [
          103.52630587304759,
          30.58949846367208
        ],
        [
          103.52619274685016,
          30.588820617440366
        ]
      ],
      [
        [
          103.76696149977029,
          30.603341796768245
        ],
        [
          103.76644052419927,
          30.603859376221056
        ]
      ],
      [
        [
          104.23707075646816,
          30.555280100902827
        ],
        [
          104.23632349173077,
          30.555514342749987
        ]
      ],
      [
        [
          103.53627913746331,
          30.598221862392812
        ],
        [
          103.53550310525976,
          30.598070976073398
        ]
      ],
      [
        [
          104.21988389656772,
          30.545089558907847
        ],
        [
          104.21992181928535,
          30.54440553234395
        ]
      ],
      [
        [
          103.530593070009,
          30.59589184637987
        ],
        [
          103.53000020396891,
          30.595435201202175
        ]
      ],
      [
        [
          103.52892125598052,
          30.5944295265307
        ],
        [
          103.5284395184052,
          30.593884547448713
        ]
      ],
      [
        [
          104.22023520065868,
          30.547805088813313
        ],
        [
          104.22007242946844,
          30.547134783937544
        ]
      ],
      [
        [
          103.75079040660798,
          30.587277950592046
        ],
        [
          103.75148556911226,
          30.586945032610735
        ]
      ],
      [
        [
          103.75148556911226,
          30.586945032610735
        ],
        [
          103.75220385541408,
          30.58665073612343
        ]
      ],
      [
        [
          104.23161822289725,
          30.556031495996184
        ],
        [
          104.23082658614197,
          30.555966393862143
        ]
      ],
      [
        [
          104.24492969839542,
          30.54577427974901
        ],
        [
          104.24486676998248,
          30.546456937723924
        ]
      ],
      [
        [
          103.76076177883016,
          30.586182586070517
        ],
        [
          103.76151755652302,
          30.5863962458015
        ]
      ],
      [
        [
          103.52646871519657,
          30.59016876857361
        ],
        [
          103.52630587304759,
          30.58949846367208
        ]
      ],
      [
        [
          103.53589033015973,
          30.577098346634603
        ],
        [
          103.53667137012033,
          30.576968760435562
        ]
      ],
      [
        [
          104.2224422284911,
          30.53872535629462
        ],
        [
          104.22294363083813,
          30.538193883893705
        ]
      ],
      [
        [
          103.54908854505385,
          30.581646826732896
        ],
        [
          103.54950799105262,
          30.582228689529163
        ]
      ],
      [
        [
          103.74801940622531,
          30.603859376221056
        ],
        [
          103.74749843065429,
          30.603341796768245
        ]
      ],
      [
        [
          104.21989642410479,
          30.54577427974901
        ],
        [
          104.21988389656772,
          30.545089558907847
        ]
      ],
      [
        [
          104.24238389400911,
          30.53872535629462
        ],
        [
          104.24284515542801,
          30.539283146717796
        ]
      ],
      [
        [
          103.52612979109865,
          30.588137959455306
        ],
        [
          103.52611725823904,
          30.58745323861212
        ]
      ],
      [
        [
          103.76907737764806,
          30.59300712939408
        ],
        [
          103.76931367181317,
          30.593661030406164
        ]
      ],
      [
        [
          104.24076749430492,
          30.537218336972447
        ],
        [
          104.241342967575,
          30.537690869117768
        ]
      ],
      [
        [
          103.55118653257064,
          30.58745323861212
        ],
        [
          103.55117399971101,
          30.588137959455306
        ]
      ],
      [
        [
          104.22118612876969,
          30.540468602311016
        ],
        [
          104.22156170426638,
          30.53986500957166
        ]
      ],
      [
        [
          103.748871115841,
          30.58849428751076
        ],
        [
          103.74948054317413,
          30.588054140334627
        ]
      ],
      [
        [
          103.52944218364823,
          30.594947105970128
        ],
        [
          103.52892125598052,
          30.5944295265307
        ]
      ],
      [
        [
          103.75220385541408,
          30.58665073612343
        ],
        [
          103.75294237390155,
          30.5863962458015
        ]
      ],
      [
        [
          103.75485698896483,
          30.60713413275126
        ],
        [
          103.75408088536405,
          30.60698324642603
        ]
      ],
      [
        [
          104.2430613941692,
          30.550950683620037
        ],
        [
          104.24262097849655,
          30.551520867403745
        ]
      ],
      [
        [
          103.53121839438816,
          30.596315202297273
        ],
        [
          103.530593070009,
          30.59589184637987
        ]
      ],
      [
        [
          104.22632005279338,
          30.55469168619368
        ],
        [
          104.22563778513336,
          30.554339883381342
        ]
      ],
      [
        [
          103.55036305999148,
          30.591475998507953
        ],
        [
          103.55005578540265,
          30.592107659267178
        ]
      ],
      [
        [
          103.7482953382756,
          30.588966819578346
        ],
        [
          103.748871115841,
          30.58849428751076
        ]
      ],
      [
        [
          104.24459092184155,
          30.547805088813313
        ],
        [
          104.24437911085738,
          30.548465153086248
        ]
      ],
      [
        [
          104.2266716999583,
          30.535669081784626
        ],
        [
          104.22738960675285,
          30.535374785236932
        ]
      ],
      [
        [
          103.53865189540484,
          30.598416906601045
        ],
        [
          103.53785670973134,
          30.598395176709715
        ]
      ],
      [
        [
          103.54886427240446,
          30.593884547448713
        ],
        [
          103.54838253482914,
          30.5944295265307
        ]
      ],
      [
        [
          104.24425421309543,
          30.541731179406
        ],
        [
          104.24449038222798,
          30.542385080462218
        ]
      ],
      [
        [
          104.24475369303175,
          30.547134783937544
        ],
        [
          104.24459092184155,
          30.547805088813313
        ]
      ],
      [
        [
          104.23594300904061,
          30.534906635084194
        ],
        [
          104.23669838744323,
          30.535120294861315
        ]
      ],
      [
        [
          104.241342967575,
          30.537690869117768
        ],
        [
          104.2418824916621,
          30.538193883893705
        ]
      ],
      [
        [
          104.23669838744323,
          30.535120294861315
        ],
        [
          104.23743651574736,
          30.535374785236932
        ]
      ],
      [
        [
          103.76297436131232,
          30.586945032610735
        ],
        [
          103.7636695238166,
          30.587277950592046
        ]
      ],
      [
        [
          104.22014819793125,
          30.54305056526324
        ],
        [
          104.22033574027223,
          30.542385080462218
        ]
      ],
      [
        [
          103.53221292875016,
          30.578365680282243
        ],
        [
          103.53290802734536,
          30.578032762289443
        ]
      ],
      [
        [
          104.23082658614197,
          30.555966393862143
        ],
        [
          104.23004133967298,
          30.555858181711514
        ]
      ],
      [
        [
          103.75012116651203,
          30.58764814991465
        ],
        [
          103.75079040660798,
          30.587277950592046
        ]
      ],
      [
        [
          104.23779926051081,
          30.555005513382618
        ],
        [
          104.23707075646816,
          30.555280100902827
        ]
      ],
      [
        [
          103.54439576346432,
          30.578032762289443
        ],
        [
          103.54509086205952,
          30.578365680282243
        ]
      ],
      [
        [
          103.76720606906493,
          30.590001306601476
        ],
        [
          103.76766757445293,
          30.590559096951107
        ]
      ],
      [
        [
          104.23360405434114,
          30.53451839804293
        ],
        [
          104.2343927222205,
          30.534605079743255
        ]
      ],
      [
        [
          104.22070701044755,
          30.549112318674908
        ],
        [
          104.22044701164283,
          30.548465153086248
        ]
      ],
      [
        [
          103.74514625861141,
          30.593661030406164
        ],
        [
          103.7453825527765,
          30.59300712939408
        ]
      ],
      [
        [
          103.5263816754795,
          30.585414245009808
        ],
        [
          103.52656929986844,
          30.58474876023827
        ]
      ],
      [
        [
          103.53255622462746,
          30.597055366671636
        ],
        [
          103.53187365889428,
          30.596703563802627
        ]
      ],
      [
        [
          104.24106097425202,
          30.55307152096733
        ],
        [
          104.24046836706896,
          30.553528166081126
        ]
      ],
      [
        [
          104.2449422259325,
          30.545089558907847
        ],
        [
          104.24492969839542,
          30.54577427974901
        ]
      ],
      [
        [
          103.76941426597631,
          30.599081038738202
        ],
        [
          103.76920234314397,
          30.59974110305109
        ]
      ],
      [
        [
          103.53399216497397,
          30.597643781480386
        ],
        [
          103.53326334263207,
          30.597369193912943
        ]
      ],
      [
        [
          104.22057190940478,
          30.541731179406
        ],
        [
          104.2208557534818,
          30.541091494862993
        ]
      ],
      [
        [
          103.5440404481776,
          30.597369193912943
        ],
        [
          103.54331162583571,
          30.597643781480386
        ]
      ],
      [
        [
          103.54141346064995,
          30.577098346634603
        ],
        [
          103.54218338437863,
          30.57727031572136
        ]
      ],
      [
        [
          104.2288831134596,
          30.534906635084194
        ],
        [
          104.22965270117626,
          30.534734665966184
        ]
      ],
      [
        [
          103.53290802734536,
          30.578032762289443
        ],
        [
          103.5336262476149,
          30.577738465791644
        ]
      ],
      [
        [
          103.52619274685016,
          30.588820617440366
        ],
        [
          103.52612979109865,
          30.588137959455306
        ]
      ],
      [
        [
          103.54180068554992,
          30.598070976073398
        ],
        [
          103.54102465334634,
          30.598221862392812
        ]
      ],
      [
        [
          103.7455177234277,
          30.60038826868784
        ],
        [
          103.74525758728058,
          30.59974110305109
        ]
      ],
      [
        [
          103.76744328164085,
          30.602796817673216
        ],
        [
          103.76696149977029,
          30.603341796768245
        ]
      ],
      [
        [
          103.74525758728058,
          30.59974110305109
        ],
        [
          103.74504566444827,
          30.599081038738202
        ]
      ],
      [
        [
          103.75960294145975,
          30.60713413275126
        ],
        [
          103.7588172795892,
          30.607242344926156
        ]
      ],
      [
        [
          104.24345892523587,
          30.550357591424785
        ],
        [
          104.2430613941692,
          30.550950683620037
        ]
      ],
      [
        [
          104.22563778513336,
          30.554339883381342
        ],
        [
          104.22498280676369,
          30.553951521936053
        ]
      ],
      [
        [
          103.76920234314397,
          30.59974110305109
        ],
        [
          103.76894220699687,
          30.60038826868784
        ]
      ],
      [
        [
          103.75603834260681,
          30.58579434911554
        ],
        [
          103.75683222400062,
          30.58575092086913
        ]
      ],
      [
        [
          104.24481608400474,
          30.543724954347038
        ],
        [
          104.24490430321487,
          30.54440553234395
        ]
      ],
      [
        [
          104.23122206815907,
          30.53451839804293
        ],
        [
          104.23201553015815,
          30.534474969786682
        ]
      ],
      [
        [
          104.22136719726434,
          30.550357591424785
        ],
        [
          104.22101415098759,
          30.549743979388328
        ]
      ],
      [
        [
          103.76894220699687,
          30.60038826868784
        ],
        [
          103.76863490417118,
          30.60101992945671
        ]
      ],
      [
        [
          104.23632349173077,
          30.555514342749987
        ],
        [
          104.23556047608662,
          30.555707295419737
        ]
      ],
      [
        [
          103.74488280735208,
          30.59841073383124
        ],
        [
          103.74476967078101,
          30.597732887595715
        ]
      ],
      [
        [
          104.24161875094794,
          30.552583425799558
        ],
        [
          104.24106097425202,
          30.55307152096733
        ]
      ],
      [
        [
          103.75113373362787,
          30.605967636987277
        ],
        [
          103.75045110510679,
          30.605615834106345
        ]
      ],
      [
        [
          103.52821524575583,
          30.581646826732896
        ],
        [
          103.5286767086945,
          30.58108903637047
        ]
      ],
      [
        [
          104.22738960675285,
          30.535374785236932
        ],
        [
          104.22812773505699,
          30.535120294861315
        ]
      ],
      [
        [
          103.52680557227855,
          30.58409485921851
        ],
        [
          103.52708954044499,
          30.58345517471837
        ]
      ],
      [
        [
          104.22812773505699,
          30.535120294861315
        ],
        [
          104.2288831134596,
          30.534906635084194
        ]
      ],
      [
        [
          103.53512040643103,
          30.57727031572136
        ],
        [
          103.53589033015973,
          30.577098346634603
        ]
      ],
      [
        [
          103.76037904506053,
          30.60698324642603
        ],
        [
          103.75960294145975,
          30.60713413275126
        ]
      ],
      [
        [
          103.54950799105262,
          30.582228689529163
        ],
        [
          103.54988373067687,
          30.58283228221498
        ]
      ],
      [
        [
          103.54023906375343,
          30.598330074563503
        ],
        [
          103.53944708107832,
          30.598395176709715
        ]
      ],
      [
        [
          103.7456665470819,
          30.59236744490297
        ],
        [
          103.74599709718697,
          30.591744552409804
        ]
      ],
      [
        [
          104.24467792456896,
          30.54305056526324
        ],
        [
          104.24481608400474,
          30.543724954347038
        ]
      ],
      [
        [
          103.74657600029394,
          30.602226633817732
        ],
        [
          103.74617825910764,
          30.601633541555092
        ]
      ],
      [
        [
          104.2418824916621,
          30.538193883893705
        ],
        [
          104.24238389400911,
          30.53872535629462
        ]
      ],
      [
        [
          103.53706472705623,
          30.598330074563503
        ],
        [
          103.53627913746331,
          30.598221862392812
        ]
      ],
      [
        [
          103.76808705904058,
          30.59114095973525
        ],
        [
          103.7684628332376,
          30.591744552409804
        ]
      ],
      [
        [
          103.75643470637712,
          30.607307447074934
        ],
        [
          103.75564265083538,
          30.607242344926156
        ]
      ],
      [
        [
          103.54608539642152,
          30.596315202297273
        ],
        [
          103.5454301319154,
          30.596703563802627
        ]
      ],
      [
        [
          103.54700997636048,
          30.579582017239503
        ],
        [
          103.54758570098012,
          30.580054549320614
        ]
      ],
      [
        [
          104.21992181928535,
          30.54440553234395
        ],
        [
          104.22001003849547,
          30.543724954347038
        ]
      ],
      [
        [
          103.53550310525976,
          30.598070976073398
        ],
        [
          103.53473975621799,
          30.597878023368885
        ]
      ],
      [
        [
          104.23320789960296,
          30.556031495996184
        ],
        [
          104.2324130612501,
          30.55605322588344
        ]
      ],
      [
        [
          103.76189012435248,
          30.606556051816998
        ],
        [
          103.76114246433116,
          30.606790293714194
        ]
      ],
      [
        [
          104.23918833736685,
          30.554339883381342
        ],
        [
          104.23850606970684,
          30.55469168619368
        ]
      ],
      [
        [
          103.52611725823904,
          30.58745323861212
        ],
        [
          103.52615519766933,
          30.586769212054342
        ]
      ],
      [
        [
          103.53473975621799,
          30.597878023368885
        ],
        [
          103.53399216497397,
          30.597643781480386
        ]
      ],
      [
        [
          104.22176472833102,
          30.550950683620037
        ],
        [
          104.22136719726434,
          30.550357591424785
        ]
      ],
      [
        [
          104.22220514400367,
          30.551520867403745
        ],
        [
          104.22176472833102,
          30.550950683620037
        ]
      ],
      [
        [
          103.52694073081818,
          30.591475998507953
        ],
        [
          103.52668061856792,
          30.590828832879563
        ]
      ],
      [
        [
          103.76863490417118,
          30.60101992945671
        ],
        [
          103.76828167131694,
          30.601633541555092
        ]
      ]
    ]

    newC.forEach((e) => {
      L.GeoJSON.geometryToLayer(turf.lineString(e))
        .on('mouseover', e => {
          e.sourceTarget.setStyle({ color: '#ff4d4f', weight: 8 })
        })
        .on('mouseout', e => {
          e.sourceTarget.setStyle({ color: '#3388ff', weight: 3 })
        })
        .addTo(map)
    })

    // const splitCoordinates = []
    // c.forEach((l) => {
    //   for (let i = 0; i < l[0].length - 1; i++) {
    //     splitCoordinates.push([l[0][i], l[0][i + 1]])
    //   }
    // })

    // function shuffle(arr) {
    //   var l = arr.length
    //   var index, temp
    //   while (l > 0) {
    //     index = Math.floor(Math.random() * l)
    //     temp = arr[l - 1]
    //     arr[l - 1] = arr[index]
    //     arr[index] = temp
    //     l--
    //   }
    //   return arr
    // }
    // console.log(splitCoordinates);


    // console.log(shuffle(splitCoordinates));

    function moveMarkerWithAnimation(marker, targetLatLng) {
      // 获取当前坐标
      const currentLatLng = marker.getLatLng();

      // 定义动画持续时间
      let duration = 800; // .8秒
      let startTime = null;

      function animateMarker(timestamp) {
        if (!startTime) startTime = timestamp;
        const progress = (timestamp - startTime) / duration;

        // 计算当前插值
        let lat = currentLatLng.lat + (targetLatLng.lat - currentLatLng.lat) * progress;
        let lng = currentLatLng.lng + (targetLatLng.lng - currentLatLng.lng) * progress;

        marker.setLatLng([lat, lng]);

        // 继续动画，直到完成
        if (progress < 1) {
          requestAnimationFrame(animateMarker);
        } else {
          marker.setLatLng(targetLatLng); // 确保最终位置准确
        }
      }

      requestAnimationFrame(animateMarker);
    }

    startMaker.on('dragend', (event) => {
      const { lat, lng } = event.target.getLatLng()
      const diffLat = latlng[0] - lat
      const diffLng = latlng[1] - lng
      fg.getLayers().forEach(element => {
        if (element.getLatLng) {
          const latLng = element.getLatLng()
          moveMarkerWithAnimation(element, L.latLng(latLng.lat - diffLat, latLng.lng - diffLng))
        }
      });
      latlng = [lat, lng]
    })

    // 判断两条线段是否共线
    function isColinear(p0, p1, p2, p3) {
      function cross(a, b) {
        return a.x * b.y - a.y * b.x;
      }
      let v0 = { x: p1.x - p0.x, y: p1.y - p0.y };
      let v1 = { x: p2.x - p0.x, y: p2.y - p0.y };
      let v2 = { x: p3.x - p0.x, y: p3.y - p0.y };
      return Math.abs(cross(v0, v1)) < 1e-8 && Math.abs(cross(v0, v2)) < 1e-8;
    }

    // 判断两条共线线段的投影区间是否重叠
    function overlapOnLine(p0, p1, p2, p3) {
      let dx = p1.x - p0.x;
      let dy = p1.y - p0.y;
      let lengthSq = dx * dx + dy * dy;
      if (lengthSq === 0) return false; // 退化为点

      // 计算投影参数 t
      let t0 = 0;
      let t1 = 1;
      let t2 = ((p2.x - p0.x) * dx + (p2.y - p0.y) * dy) / lengthSq;
      let t3 = ((p3.x - p0.x) * dx + (p3.y - p0.y) * dy) / lengthSq;

      // 找到 t2 和 t3 的最小值和最大值
      let minT = Math.min(t2, t3);
      let maxT = Math.max(t2, t3);

      // 检查是否有重叠
      return minT < t1 && maxT > t0;
    }

    // 判断两条线段是否相交（不共线情况）
    function segmentsIntersect(p0, p1, p2, p3) {
      function cross(o, a, b) {
        return (a.x - o.x) * (b.y - o.y) - (a.y - o.y) * (b.x - o.x);
      }
      let o1 = cross(p0, p1, p2);
      let o2 = cross(p0, p1, p3);
      let o3 = cross(p2, p3, p0);
      let o4 = cross(p2, p3, p1);

      // 判断是否相交
      if ((o1 * o2 < 0) && (o3 * o4 < 0)) return true;
      return false;
    }

    // 判断多条线段是否可以合并为一条线
    function canMergeSegments(segments) {
      if (segments.length === 0) return false;
      if (segments.length === 1) return true;

      // 提取所有端点
      let points = [];
      for (let seg of segments) {
        points.push(seg[0], seg[1]);
      }

      // 选择前两个点确定直线方向向量
      let p0 = points[0];
      let p1 = points[1];
      let dx = p1.x - p0.x;
      let dy = p1.y - p0.y;

      // 检查所有点是否在同一直线上
      for (let p of points) {
        let cross = (p.x - p0.x) * dy - (p.y - p0.y) * dx;
        if (Math.abs(cross) > 1e-8) {
          return false; // 不在同一直线上
        }
      }

      // 计算投影到直线的一维坐标
      let lengthSq = dx * dx + dy * dy;
      if (lengthSq === 0) return false; // 退化为点

      let projections = [];
      for (let p of points) {
        let t = ((p.x - p0.x) * dx + (p.y - p0.y) * dy) / lengthSq;
        projections.push(t);
      }

      // 找出最小和最大投影值
      let minT = Math.min(...projections);
      let maxT = Math.max(...projections);
      let totalSpan = maxT - minT;

      // 收集所有线段的区间
      let intervals = [];
      for (let seg of segments) {
        let t1 = ((seg[0].x - p0.x) * dx + (seg[0].y - p0.y) * dy) / lengthSq;
        let t2 = ((seg[1].x - p0.x) * dx + (seg[1].y - p0.y) * dy) / lengthSq;
        if (t1 > t2) [t1, t2] = [t2, t1];
        intervals.push([t1, t2]);
      }

      // 按起点排序
      intervals.sort((a, b) => a[0] - b[0]);

      // 合并重叠区间
      let merged = [];
      for (let interval of intervals) {
        if (merged.length === 0) {
          merged.push(interval);
        } else {
          let last = merged[merged.length - 1];
          if (interval[0] <= last[1]) {
            last[1] = Math.max(last[1], interval[1]);
          } else {
            merged.push(interval);
          }
        }
      }

      // 计算合并后的总长度
      let mergedLength = 0;
      for (let interval of merged) {
        mergedLength += interval[1] - interval[0];
      }

      // 比较总长度与总跨度
      return Math.abs(mergedLength - totalSpan) < 1e-8;
    }

    // 测试数据
    let segments = [
      [{ x: 32.123697, y: 120.123 }, { x: 1, y: 1 }],
      [{ x: 1, y: 1 }, { x: 2, y: 2 }],
      [{ x: 2, y: 2 }, { x: 3, y: 3 }]
    ];

    console.log(canMergeSegments(segments)); // 输出: true
  </script>
</body>

</html>
